#!/usr/bin/env node

/**
 * GitHub Browser Search
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –ø–æ–∏—Å–∫–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –Ω–∞ GitHub
 */

const fs = require('fs');
const path = require('path');

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∞–Ω–∞–ª–∏–∑ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
const analysisPath = path.join(__dirname, 'github-repo-analysis.json');
const analysis = JSON.parse(fs.readFileSync(analysisPath, 'utf8'));

/**
 * –°–æ–∑–¥–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
 */
function createBrowserSearchInstructions() {
  const instructions = [];
  
  // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 10 –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
  const componentsToSearch = analysis.components.slice(0, 10);
  
  for (const component of componentsToSearch) {
    const searchQueries = component.githubSearchQueries.slice(0, 3); // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 3 –∑–∞–ø—Ä–æ—Å–∞
    
    instructions.push({
      componentName: component.componentName,
      originalUrl: component.originalUrl,
      searchQueries: searchQueries.map(query => ({
        name: query.name,
        url: `https://github.com/search?q=${encodeURIComponent(query.query)}&type=repositories&s=stars`,
        description: query.description
      }))
    });
  }
  
  return instructions;
}

/**
 * –°–æ–∑–¥–∞–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É –¥–ª—è –ø–æ–∏—Å–∫–∞
 */
function createSearchHTML(instructions) {
  let html = `<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub Repository Search</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f6f8fa;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .component {
            background: white;
            margin-bottom: 20px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .component-header {
            background: #24292e;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
        }
        .component-content {
            padding: 20px;
        }
        .search-query {
            margin-bottom: 15px;
            padding: 15px;
            background: #f6f8fa;
            border-radius: 6px;
            border-left: 4px solid #0366d6;
        }
        .search-query h4 {
            margin: 0 0 10px 0;
            color: #24292e;
        }
        .search-query p {
            margin: 0 0 10px 0;
            color: #586069;
            font-size: 14px;
        }
        .search-link {
            display: inline-block;
            background: #0366d6;
            color: white;
            padding: 8px 16px;
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
        }
        .search-link:hover {
            background: #0256cc;
        }
        .original-link {
            color: #586069;
            font-size: 12px;
            margin-top: 10px;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 24px;
            font-weight: 600;
            color: #0366d6;
        }
        .stat-label {
            font-size: 14px;
            color: #586069;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üîç GitHub Repository Search</h1>
        <p>–ü–æ–∏—Å–∫ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ v0.app</p>
    </div>

    <div class="stats">
        <div class="stat-card">
            <div class="stat-number">${instructions.length}</div>
            <div class="stat-label">–ö–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">${instructions.reduce((sum, comp) => sum + comp.searchQueries.length, 0)}</div>
            <div class="stat-label">–ü–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤</div>
        </div>
        <div class="stat-card">
            <div class="stat-number">${analysis.metadata.totalLinks}</div>
            <div class="stat-label">–í—Å–µ–≥–æ —Å—Å—ã–ª–æ–∫ v0.app</div>
        </div>
    </div>
`;

  instructions.forEach((instruction, index) => {
    html += `
    <div class="component">
        <div class="component-header">
            ${index + 1}. ${instruction.componentName}
        </div>
        <div class="component-content">
            <div class="original-link">
                üìé –û—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞: <a href="${instruction.originalUrl}" target="_blank">${instruction.originalUrl}</a>
            </div>
`;

    instruction.searchQueries.forEach((query, queryIndex) => {
      html += `
            <div class="search-query">
                <h4>${queryIndex + 1}. ${query.name}</h4>
                <p>${query.description}</p>
                <a href="${query.url}" target="_blank" class="search-link">üîç –ü–æ–∏—Å–∫ –Ω–∞ GitHub</a>
            </div>
`;
    });

    html += `
        </div>
    </div>
`;
  });

  html += `
    <div class="header">
        <h2>üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é</h2>
        <ol>
            <li>–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "üîç –ü–æ–∏—Å–∫ –Ω–∞ GitHub" –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞</li>
            <li>–ù–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ GitHub –∏–∑—É—á–∏—Ç–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</li>
            <li>–û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞:
                <ul>
                    <li>‚≠ê –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è > 10)</li>
                    <li>üìÖ –î–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è < 6 –º–µ—Å—è—Ü–µ–≤)</li>
                    <li>üìù –ù–∞–ª–∏—á–∏–µ README —Ñ–∞–π–ª–∞</li>
                    <li>üè∑Ô∏è –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ç–µ–≥–∏ (react, nextjs, ui, component)</li>
                    <li>üì¶ –ù–∞–ª–∏—á–∏–µ package.json</li>
                </ul>
            </li>
            <li>–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏</li>
            <li>–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤ —Ñ–∞–π–ª github-found-repositories.json</li>
        </ol>
    </div>

    <script>
        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å—Å—ã–ª–æ–∫ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
        function openAllSearches() {
            const links = document.querySelectorAll('.search-link');
            links.forEach((link, index) => {
                setTimeout(() => {
                    window.open(link.href, '_blank');
                }, index * 2000); // –ó–∞–¥–µ—Ä–∂–∫–∞ 2 —Å–µ–∫—É–Ω–¥—ã –º–µ–∂–¥—É –æ—Ç–∫—Ä—ã—Ç–∏–µ–º
            });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ—Ç–∫—Ä—ã—Ç–∏—è –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫
        const autoOpenBtn = document.createElement('button');
        autoOpenBtn.textContent = 'üöÄ –û—Ç–∫—Ä—ã—Ç—å –≤—Å–µ –ø–æ–∏—Å–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏';
        autoOpenBtn.style.cssText = \`
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            z-index: 1000;
        \`;
        autoOpenBtn.onclick = openAllSearches;
        document.body.appendChild(autoOpenBtn);
    </script>
</body>
</html>`;

  return html;
}

/**
 * –°–æ–∑–¥–∞–µ—Ç JSON —à–∞–±–ª–æ–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
 */
function createResultsTemplate(instructions) {
  const template = {
    metadata: {
      searchDate: new Date().toISOString(),
      totalComponents: instructions.length,
      description: "–ù–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –Ω–∞ GitHub –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ v0.app"
    },
    results: instructions.map(instruction => ({
      componentName: instruction.componentName,
      originalUrl: instruction.originalUrl,
      foundRepositories: []
    }))
  };

  return template;
}

/**
 * –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
 */
function main() {
  console.log('üöÄ –°–æ–∑–¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ...');
  
  const instructions = createBrowserSearchInstructions();
  const html = createSearchHTML(instructions);
  const resultsTemplate = createResultsTemplate(instructions);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É
  const htmlPath = path.join(__dirname, 'github-search-page.html');
  fs.writeFileSync(htmlPath, html);
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º —à–∞–±–ª–æ–Ω –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  const templatePath = path.join(__dirname, 'github-found-repositories.json');
  fs.writeFileSync(templatePath, JSON.stringify(resultsTemplate, null, 2));
  
  console.log('‚úÖ –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã:');
  console.log(`  - ${htmlPath} - HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞`);
  console.log(`  - ${templatePath} - –®–∞–±–ª–æ–Ω –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤`);
  
  console.log('\nüîç –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:');
  console.log('  1. –û—Ç–∫—Ä–æ–π—Ç–µ github-search-page.html –≤ –±—Ä–∞—É–∑–µ—Ä–µ');
  console.log('  2. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫–∏ –ø–æ–∏—Å–∫–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞');
  console.log('  3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –Ω–∞–π–¥–µ–Ω–Ω—ã–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –≤ github-found-repositories.json');
  console.log('  4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "üöÄ –û—Ç–∫—Ä—ã—Ç—å –≤—Å–µ –ø–æ–∏—Å–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏" –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞');
}

if (require.main === module) {
  main();
}

module.exports = {
  createBrowserSearchInstructions,
  createSearchHTML,
  createResultsTemplate
};


