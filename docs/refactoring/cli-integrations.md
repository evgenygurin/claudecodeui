# CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ Claude Code UI

## üîß –û–±–∑–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π

Claude Code UI –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å —Ç—Ä–µ–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏: Claude CLI, Cursor CLI –∏ Codegen CLI. –ö–∞–∂–¥–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏–º–µ–µ—Ç —Å–≤–æ–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.

## ü§ñ Claude CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
```javascript
// server/claude-cli.js
import { spawn } from 'child_process';
import { EventEmitter } from 'events';

class ClaudeCliManager extends EventEmitter {
  constructor() {
    super();
    this.activeSessions = new Map();
    this.processes = new Map();
  }

  async spawnSession(projectPath, sessionId) {
    const process = spawn('claude', ['chat', '--project', projectPath], {
      cwd: projectPath,
      env: {
        ...process.env,
        CLAUDE_API_KEY: process.env.CLAUDE_API_KEY
      },
      stdio: ['pipe', 'pipe', 'pipe']
    });

    this.processes.set(sessionId, process);
    this.setupProcessHandlers(process, sessionId);
    
    return sessionId;
  }
}
```

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
```javascript
// –¢—Ä–µ–±—É–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
CLAUDE_API_KEY=your_api_key_here
CLAUDE_CLI_PATH=/usr/local/bin/claude

// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
{
  "claude": {
    "model": "claude-3-sonnet-20240229",
    "maxTokens": 4096,
    "temperature": 0.7,
    "systemPrompt": "You are a helpful coding assistant."
  }
}
```

### **–§–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏–π**
```javascript
// –í—Ö–æ–¥—è—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
{
  "role": "user",
  "content": "Can you help me refactor this component?",
  "attachments": [
    {
      "type": "file",
      "path": "./src/Component.jsx",
      "content": "file_content_here"
    }
  ]
}

// –û—Ç–≤–µ—Ç –æ—Ç Claude
{
  "role": "assistant", 
  "content": "I can help you refactor this component...",
  "metadata": {
    "tokensUsed": 150,
    "model": "claude-3-sonnet-20240229",
    "timestamp": "2024-01-15T10:30:00Z"
  }
}
```

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤**
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç
const includeProjectFiles = async (projectPath, message) => {
  const relevantFiles = await findRelevantFiles(projectPath, message);
  
  return {
    ...message,
    context: relevantFiles.map(file => ({
      path: file.path,
      content: file.content,
      language: detectLanguage(file.path)
    }))
  };
};
```

### **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏**
```javascript
// –ó–∞—â–∏—Ç–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π
const protectSession = (sessionId) => {
  activeSessions.add(sessionId);
  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ–µ–∫—Ç–∞
  projectUpdateManager.pauseUpdates(sessionId);
};

const unprotectSession = (sessionId) => {
  activeSessions.delete(sessionId);
  projectUpdateManager.resumeUpdates(sessionId);
};
```

## ‚ö° Cursor CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
```javascript
// server/cursor-cli.js
class CursorCliManager extends EventEmitter {
  constructor() {
    super();
    this.cursorPath = process.env.CURSOR_CLI_PATH || 'cursor';
  }

  async spawnSession(projectPath, sessionId) {
    const process = spawn(this.cursorPath, [
      '--chat',
      '--project', projectPath,
      '--session', sessionId
    ], {
      cwd: projectPath,
      stdio: ['pipe', 'pipe', 'pipe']
    });

    return this.setupCursorProcess(process, sessionId);
  }

  setupCursorProcess(process, sessionId) {
    process.stdout.on('data', (data) => {
      const message = this.parseCursorOutput(data.toString());
      this.emit('message', sessionId, message);
    });

    process.stderr.on('data', (data) => {
      this.emit('error', sessionId, data.toString());
    });

    return sessionId;
  }
}
```

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
```javascript
// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Cursor CLI
{
  "cursor": {
    "model": "gpt-4",
    "codebaseContext": true,
    "autoImports": true,
    "linting": true,
    "formatting": true
  }
}

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
CURSOR_CLI_PATH=/Applications/Cursor.app/Contents/Resources/app/bin/cursor
CURSOR_API_KEY=your_cursor_api_key
```

### **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
```javascript
// Cursor-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
const cursorCommands = {
  // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫ —Ñ–∞–π–ª–∞–º
  applyChanges: async (sessionId, changes) => {
    const process = this.processes.get(sessionId);
    process.stdin.write(JSON.stringify({
      command: 'apply_changes',
      changes: changes
    }) + '\n');
  },

  // –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã
  getCodebaseContext: async (projectPath) => {
    return spawn(this.cursorPath, [
      '--get-context',
      '--project', projectPath
    ]);
  },

  // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
  formatCode: async (filePath, content) => {
    return spawn(this.cursorPath, [
      '--format',
      '--file', filePath
    ]);
  }
};
```

### **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ñ–∞–π–ª–æ–≤**
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
const handleCursorChanges = (sessionId, changes) => {
  changes.forEach(async (change) => {
    switch (change.type) {
      case 'file_edit':
        await applyFileEdit(change.path, change.content);
        break;
      case 'file_create':
        await createFile(change.path, change.content);
        break;
      case 'file_delete':
        await deleteFile(change.path);
        break;
    }
  });

  // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ frontend –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö
  websocketManager.broadcast('files_changed', {
    sessionId,
    changes
  });
};
```

## üîß Codegen CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**
```javascript
// server/codegen-cli.js
class CodegenCliManager extends EventEmitter {
  constructor() {
    super();
    this.apiKey = process.env.CODEGEN_API_KEY;
    this.baseUrl = 'https://api.codegen.com/v1';
  }

  async createSession(projectPath, sessionId) {
    // Codegen –∏—Å–ø–æ–ª—å–∑—É–µ—Ç API –≤–º–µ—Å—Ç–æ CLI –ø—Ä–æ—Ü–µ—Å—Å–∞
    const session = await this.apiCall('/sessions', {
      method: 'POST',
      body: {
        projectPath,
        sessionId,
        config: await this.getProjectConfig(projectPath)
      }
    });

    return session.id;
  }

  async sendMessage(sessionId, message) {
    const response = await this.apiCall(`/sessions/${sessionId}/messages`, {
      method: 'POST',
      body: {
        content: message.content,
        attachments: message.attachments,
        context: await this.getProjectContext(sessionId)
      }
    });

    return response;
  }
}
```

### **API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
```javascript
// HTTP API –≤–º–µ—Å—Ç–æ CLI –ø—Ä–æ—Ü–µ—Å—Å–∞
const codegenApiCall = async (endpoint, options = {}) => {
  const response = await fetch(`${baseUrl}${endpoint}`, {
    method: options.method || 'GET',
    headers: {
      'Authorization': `Bearer ${apiKey}`,
      'Content-Type': 'application/json',
      ...options.headers
    },
    body: options.body ? JSON.stringify(options.body) : undefined
  });

  if (!response.ok) {
    throw new Error(`Codegen API error: ${response.statusText}`);
  }

  return response.json();
};
```

### **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è**
```javascript
// –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Codegen
{
  "codegen": {
    "model": "codegen-v2",
    "features": {
      "codeGeneration": true,
      "codeReview": true,
      "testing": true,
      "documentation": true
    },
    "integrations": {
      "github": true,
      "linear": true,
      "slack": false
    }
  }
}

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
CODEGEN_API_KEY=your_codegen_api_key
CODEGEN_ORG_ID=your_org_id
```

### **–°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**
```javascript
// Codegen-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
const codegenFeatures = {
  // –°–æ–∑–¥–∞–Ω–∏–µ PR
  createPullRequest: async (sessionId, changes) => {
    return await apiCall(`/sessions/${sessionId}/pr`, {
      method: 'POST',
      body: {
        title: 'AI-generated changes',
        description: 'Changes generated by Codegen AI',
        changes
      }
    });
  },

  // –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á –≤ Linear
  createLinearTask: async (sessionId, task) => {
    return await apiCall(`/sessions/${sessionId}/linear/tasks`, {
      method: 'POST',
      body: task
    });
  },

  // –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
  analyzeCode: async (projectPath) => {
    return await apiCall('/analyze', {
      method: 'POST',
      body: { projectPath }
    });
  }
};
```

## üîÑ –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### **–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å**
```javascript
// –ë–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è –≤—Å–µ—Ö CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
class BaseCLIManager extends EventEmitter {
  constructor(type) {
    super();
    this.type = type;
    this.sessions = new Map();
  }

  // –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –º–µ—Ç–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
  async createSession(projectPath, sessionId) {
    throw new Error('createSession must be implemented');
  }

  async sendMessage(sessionId, message) {
    throw new Error('sendMessage must be implemented');
  }

  async abortSession(sessionId) {
    throw new Error('abortSession must be implemented');
  }

  // –û–±—â–∏–µ –º–µ—Ç–æ–¥—ã
  getSession(sessionId) {
    return this.sessions.get(sessionId);
  }

  getAllSessions() {
    return Array.from(this.sessions.values());
  }
}
```

### **–§–∞–±—Ä–∏–∫–∞ CLI –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤**
```javascript
// –§–∞–±—Ä–∏–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è CLI –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
class CLIManagerFactory {
  static create(type) {
    switch (type) {
      case 'claude':
        return new ClaudeCliManager();
      case 'cursor':
        return new CursorCliManager();
      case 'codegen':
        return new CodegenCliManager();
      default:
        throw new Error(`Unknown CLI type: ${type}`);
    }
  }

  static getSupportedTypes() {
    return ['claude', 'cursor', 'codegen'];
  }
}
```

### **–ï–¥–∏–Ω—ã–π API –¥–ª—è frontend**
```javascript
// –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π API endpoint
app.post('/api/sessions/:sessionId/messages', async (req, res) => {
  const { sessionId } = req.params;
  const { content, attachments } = req.body;

  try {
    const session = sessionManager.getSession(sessionId);
    const cliManager = CLIManagerFactory.create(session.type);
    
    const response = await cliManager.sendMessage(sessionId, {
      content,
      attachments
    });

    res.json(response);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

### **–ú–µ—Ç—Ä–∏–∫–∏ –ø–æ CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è–º**
```javascript
// –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ CLI
const cliMetrics = {
  claude: {
    sessionsCount: 0,
    messagesCount: 0,
    tokensUsed: 0,
    averageResponseTime: 0,
    errorRate: 0
  },
  cursor: {
    sessionsCount: 0,
    messagesCount: 0,
    changesApplied: 0,
    averageResponseTime: 0,
    errorRate: 0
  },
  codegen: {
    sessionsCount: 0,
    messagesCount: 0,
    prsCreated: 0,
    tasksCreated: 0,
    averageResponseTime: 0,
    errorRate: 0
  }
};
```

### **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```javascript
// –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è CLI –æ–ø–µ—Ä–∞—Ü–∏–π
const logCLIOperation = (type, operation, sessionId, metadata = {}) => {
  logger.info('CLI operation', {
    cliType: type,
    operation,
    sessionId,
    timestamp: new Date().toISOString(),
    ...metadata
  });
};
```

## üö® –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### **–¢–∏–ø—ã –æ—à–∏–±–æ–∫**
```javascript
// –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ CLI
class CLIError extends Error {
  constructor(type, code, message, details = {}) {
    super(message);
    this.name = 'CLIError';
    this.type = type;
    this.code = code;
    this.details = details;
  }
}

// –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫
const CLI_ERRORS = {
  CLAUDE_API_KEY_MISSING: 'Claude API key is not configured',
  CURSOR_NOT_INSTALLED: 'Cursor CLI is not installed',
  CODEGEN_RATE_LIMIT: 'Codegen API rate limit exceeded',
  SESSION_NOT_FOUND: 'Session not found',
  PROCESS_CRASHED: 'CLI process crashed unexpectedly'
};
```

### **Retry –º–µ—Ö–∞–Ω–∏–∑–º**
```javascript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
const retryOperation = async (operation, maxRetries = 3) => {
  for (let attempt = 1; attempt <= maxRetries; attempt++) {
    try {
      return await operation();
    } catch (error) {
      if (attempt === maxRetries) {
        throw error;
      }
      
      const delay = Math.pow(2, attempt) * 1000; // Exponential backoff
      await new Promise(resolve => setTimeout(resolve, delay));
    }
  }
};
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ CLI**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤
const detectCLITools = async () => {
  const tools = {};

  // Claude CLI
  try {
    await execAsync('claude --version');
    tools.claude = {
      available: true,
      path: await which('claude'),
      version: await getCLIVersion('claude')
    };
  } catch {
    tools.claude = { available: false };
  }

  // Cursor CLI
  try {
    await execAsync('cursor --version');
    tools.cursor = {
      available: true,
      path: await which('cursor'),
      version: await getCLIVersion('cursor')
    };
  } catch {
    tools.cursor = { available: false };
  }

  // Codegen (API-based)
  try {
    const response = await fetch('https://api.codegen.com/v1/health');
    tools.codegen = {
      available: response.ok,
      apiUrl: 'https://api.codegen.com/v1',
      version: 'v1'
    };
  } catch {
    tools.codegen = { available: false };
  }

  return tools;
};
```

### **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫
const validateCLIConfig = (type, config) => {
  const validators = {
    claude: (config) => {
      if (!config.apiKey) throw new Error('Claude API key is required');
      if (!config.model) throw new Error('Claude model is required');
    },
    cursor: (config) => {
      if (!config.path) throw new Error('Cursor CLI path is required');
    },
    codegen: (config) => {
      if (!config.apiKey) throw new Error('Codegen API key is required');
      if (!config.orgId) throw new Error('Codegen organization ID is required');
    }
  };

  const validator = validators[type];
  if (validator) {
    validator(config);
  }
};
```

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —É–ª—É—á—à–µ–Ω–∏—é

### **1. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–≤**
```javascript
// –ï–¥–∏–Ω—ã–π –ø—Ä–æ—Ç–æ–∫–æ–ª —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è –≤—Å–µ—Ö CLI
const standardMessage = {
  id: 'uuid',
  sessionId: 'string',
  type: 'user|assistant|system',
  content: 'string',
  attachments: [],
  metadata: {
    timestamp: 'ISO_date',
    tokens: 'number',
    model: 'string'
  }
};
```

### **2. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–≤–µ—Ç–æ–≤**
```javascript
// –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è –∑–∞–ø—Ä–æ—Å–æ–≤
const responseCache = new Map();

const getCachedResponse = (messageHash) => {
  return responseCache.get(messageHash);
};

const cacheResponse = (messageHash, response) => {
  responseCache.set(messageHash, {
    response,
    timestamp: Date.now(),
    ttl: 3600000 // 1 hour
  });
};
```

### **3. Batch –æ–ø–µ—Ä–∞—Ü–∏–∏**
```javascript
// –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
const batchMessages = async (sessionId, messages) => {
  const batchSize = 5;
  const batches = [];
  
  for (let i = 0; i < messages.length; i += batchSize) {
    batches.push(messages.slice(i, i + batchSize));
  }

  return Promise.all(
    batches.map(batch => processBatch(sessionId, batch))
  );
};
```

### **4. Graceful degradation**
```javascript
// Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ CLI
const sendMessageWithFallback = async (sessionId, message) => {
  const session = getSession(sessionId);
  const primaryCLI = session.type;
  
  try {
    return await sendMessage(primaryCLI, sessionId, message);
  } catch (error) {
    // –ü–æ–ø—ã—Ç–∫–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π CLI
    const fallbackCLI = getFallbackCLI(primaryCLI);
    if (fallbackCLI) {
      return await sendMessage(fallbackCLI, sessionId, message);
    }
    throw error;
  }
};
```

–≠—Ç–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ CLI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≥–∏–±–∫–æ—Å—Ç—å, –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ª–µ–≥–∫–æ–≥–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö CLI –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ –±—É–¥—É—â–µ–º.
