# CircleCI Configuration

This directory contains the CircleCI configuration for the Claude Code UI project.

## Configuration Overview

The CircleCI setup includes:

### Jobs

1. **install-deps**: Installs and caches Node.js dependencies
2. **lint-and-typecheck**: Runs ESLint, TypeScript type checking, and Prettier formatting checks
3. **test**: Runs unit tests with Jest and generates coverage reports
4. **e2e-tests**: Runs end-to-end tests with Cypress
5. **build**: Builds the Next.js application for production
6. **deploy**: Deploys to Vercel (when configured)

### Workflows

#### test-and-deploy

- Runs on main and develop branches
- Full pipeline including E2E tests and deployment
- Deploys to production only on main branch

#### quick-checks

- Runs on feature branches
- Faster feedback with linting, type checking, and unit tests
- Excludes E2E tests and deployment for speed

## Environment Variables

Configure these in your CircleCI project settings:

### Required

- `VERCEL_TOKEN`: Your Vercel deployment token (for deployments)

### Optional

- `CYPRESS_RECORD_KEY`: Cypress record key for parallel test runs
- `GITHUB_TOKEN`: GitHub token for private repository access

## Setup Instructions

1. **Connect your repository to CircleCI**:
   - Go to [CircleCI](https://circleci.com)
   - Add your GitHub repository
   - CircleCI will automatically detect the `.circleci/config.yml` file

2. **Configure environment variables**:
   - Go to Project Settings â†’ Environment Variables
   - Add the required environment variables listed above

3. **Enable Vercel deployment** (optional):
   - Get your Vercel token from your Vercel dashboard
   - Add it as `VERCEL_TOKEN` in CircleCI environment variables

4. **Enable Cypress recording** (optional):
   - Get your Cypress record key from your Cypress dashboard
   - Add it as `CYPRESS_RECORD_KEY` in CircleCI environment variables

## Local Development

You can run the same commands locally that CircleCI runs:

```bash
# Install dependencies
npm install

# Run linting and type checking
npm run lint
npm run type-check
npm run format:check

# Run unit tests
npm run test:ci

# Run E2E tests
npm run test:e2e

# Build the application
npm run build
```

## Troubleshooting

### Common Issues

1. **Build failures**: Check that all dependencies are properly listed in `package.json`
2. **Test failures**: Ensure all tests pass locally before pushing
3. **Deployment failures**: Verify your Vercel token is correctly configured
4. **E2E test failures**: Check that the application builds successfully before running E2E tests

### Debugging

- Check the CircleCI logs for detailed error messages
- Use the "Rerun job with SSH" option to debug issues interactively
- Review the artifacts (screenshots, videos) generated by failed E2E tests

## Performance Optimization

The configuration is optimized for:

- **Parallel execution**: Jobs run in parallel where possible
- **Caching**: Dependencies are cached to speed up builds
- **Conditional execution**: E2E tests and deployments only run when appropriate
- **Fast feedback**: Feature branches get quick feedback without full pipeline
