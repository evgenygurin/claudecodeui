#!/usr/bin/env node

/**
 * v0.app Component Collector
 * 
 * –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞–µ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã v0.app –≤ –µ–¥–∏–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
 * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç MCP Vercel –¥–ª—è –ø–æ–∏—Å–∫–∞ GitHub —Å—Å—ã–ª–æ–∫ –∏ –±—Ä–∞—É–∑–µ—Ä –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∫–æ–¥–∞
 * 
 * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: node v0-component-collector.js
 */

const fs = require('fs');
const path = require('path');

// –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö
const componentsInfo = JSON.parse(fs.readFileSync('v0-unified-project/components-info.json', 'utf8'));

// –°–æ–∑–¥–∞–µ–º –ø–ª–∞–Ω —Å–±–æ—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
function createCollectionPlan() {
  const plan = {
    phases: [
      {
        name: "Phase 1: GitHub Integration",
        description: "–ü–æ–∏—Å–∫ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —á–µ—Ä–µ–∑ MCP Vercel",
        components: componentsInfo.components.filter(c => c.author !== 'unknown'),
        status: 'pending'
      },
      {
        name: "Phase 2: Browser Extraction",
        description: "–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä",
        components: componentsInfo.components,
        status: 'pending'
      },
      {
        name: "Phase 3: Code Integration",
        description: "–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å–æ–±—Ä–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞ –≤ –µ–¥–∏–Ω—ã–π –ø—Ä–æ–µ–∫—Ç",
        components: componentsInfo.components,
        status: 'pending'
      },
      {
        name: "Phase 4: Build System",
        description: "–ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º—ã —Å–±–æ—Ä–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è",
        components: [],
        status: 'pending'
      }
    ],
    statistics: {
      totalComponents: componentsInfo.total,
      withGitHub: 0,
      extracted: 0,
      integrated: 0,
      ready: 0
    }
  };

  return plan;
}

// –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
function createComponentStructure(component) {
  const componentDir = path.join('v0-unified-project/components', component.name);
  
  const structure = {
    [`${component.name}.tsx`]: `// ${component.name}
// –ê–≤—Ç–æ—Ä: ${component.author}
// URL: ${component.url}
// –¢–∏–ø: ${component.type}

import React from 'react';

interface ${component.name.replace(/-/g, '')}Props {
  // –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–ø—Å—ã –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
}

export const ${component.name.replace(/-/g, '')}: React.FC<${component.name.replace(/-/g, '')}Props> = (props) => {
  return (
    <div className="${component.name}">
      {/* –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∑–¥–µ—Å—å */}
      <h2>${component.name}</h2>
      <p>–ê–≤—Ç–æ—Ä: ${component.author}</p>
      <p>URL: <a href="${component.url}" target="_blank" rel="noopener noreferrer">${component.url}</a></p>
    </div>
  );
};

export default ${component.name.replace(/-/g, '')};`,
    [`${component.name}.stories.tsx`]: `// Storybook story –¥–ª—è ${component.name}
import type { Meta, StoryObj } from '@storybook/react';
import { ${component.name.replace(/-/g, '')} } from './${component.name}';

const meta: Meta<typeof ${component.name.replace(/-/g, '')}> = {
  title: 'Components/${component.name}',
  component: ${component.name.replace(/-/g, '')},
  parameters: {
    layout: 'centered',
  },
  tags: ['autodocs'],
};

export default meta;
type Story = StoryObj<typeof meta>;

export const Default: Story = {
  args: {},
};`,
    [`${component.name}.test.tsx`]: `// –¢–µ—Å—Ç—ã –¥–ª—è ${component.name}
import { render, screen } from '@testing-library/react';
import { ${component.name.replace(/-/g, '')} } from './${component.name}';

describe('${component.name.replace(/-/g, '')}', () => {
  it('renders without crashing', () => {
    render(<${component.name.replace(/-/g, '')} />);
    expect(screen.getByText('${component.name}')).toBeInTheDocument();
  });

  it('displays author information', () => {
    render(<${component.name.replace(/-/g, '')} />);
    expect(screen.getByText('–ê–≤—Ç–æ—Ä: ${component.author}')).toBeInTheDocument();
  });

  it('has working link to original', () => {
    render(<${component.name.replace(/-/g, '')} />);
    const link = screen.getByRole('link');
    expect(link).toHaveAttribute('href', '${component.url}');
    expect(link).toHaveAttribute('target', '_blank');
  });
});`,
    'index.ts': `// –≠–∫—Å–ø–æ—Ä—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ ${component.name}
export { ${component.name.replace(/-/g, '')} } from './${component.name}';
export { default } from './${component.name}';`
  };

  return { componentDir, structure };
}

// –°–æ–∑–¥–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –∫–∞—Ç–∞–ª–æ–≥–æ–º –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
function createMainPage() {
  const mainPageContent = `// –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–∞—Ç–∞–ª–æ–≥–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ v0.app
import React from 'react';
import Link from 'next/link';

const components = ${JSON.stringify(componentsInfo.components, null, 2)};

export default function HomePage() {
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="container mx-auto px-4 py-8">
        <header className="text-center mb-12">
          <h1 className="text-4xl font-bold text-gray-900 mb-4">
            v0.app Components Catalog
          </h1>
          <p className="text-xl text-gray-600 mb-8">
            –ï–¥–∏–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ v0.app
          </p>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
            <div className="bg-white p-4 rounded-lg shadow">
              <h3 className="font-semibold text-gray-900">–í—Å–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤</h3>
              <p className="text-2xl font-bold text-blue-600">{componentsInfo.total}</p>
            </div>
            <div className="bg-white p-4 rounded-lg shadow">
              <h3 className="font-semibold text-gray-900">Community</h3>
              <p className="text-2xl font-bold text-green-600">{componentsInfo.byType.community}</p>
            </div>
            <div className="bg-white p-4 rounded-lg shadow">
              <h3 className="font-semibold text-gray-900">Chat</h3>
              <p className="text-2xl font-bold text-purple-600">{componentsInfo.byType.chat}</p>
            </div>
          </div>
        </header>

        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {components.map((component) => (
            <div key={component.name} className="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
              <h2 className="text-xl font-semibold text-gray-900 mb-2">
                {component.name.replace(/-/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}
              </h2>
              <p className="text-gray-600 mb-4">
                –ê–≤—Ç–æ—Ä: <span className="font-medium">{component.author}</span>
              </p>
              <div className="flex items-center justify-between mb-4">
                <span className={\`px-2 py-1 rounded-full text-xs font-medium \${
                  component.type === 'community' 
                    ? 'bg-green-100 text-green-800' 
                    : 'bg-purple-100 text-purple-800'
                }\`}>
                  {component.type}
                </span>
                <span className={\`px-2 py-1 rounded-full text-xs font-medium \${
                  component.status === 'pending' 
                    ? 'bg-yellow-100 text-yellow-800' 
                    : 'bg-green-100 text-green-800'
                }\`}>
                  {component.status}
                </span>
              </div>
              <div className="space-y-2">
                <a 
                  href={component.url} 
                  target="_blank" 
                  rel="noopener noreferrer"
                  className="block w-full text-center bg-blue-600 text-white py-2 px-4 rounded hover:bg-blue-700 transition-colors"
                >
                  –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ä–∏–≥–∏–Ω–∞–ª
                </a>
                {component.githubLink && (
                  <a 
                    href={component.githubLink} 
                    target="_blank" 
                    rel="noopener noreferrer"
                    className="block w-full text-center bg-gray-600 text-white py-2 px-4 rounded hover:bg-gray-700 transition-colors"
                  >
                    GitHub
                  </a>
                )}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  );
}`;

  return mainPageContent;
}

// –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
function main() {
  console.log('üöÄ –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞–Ω–∞ —Å–±–æ—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ v0.app...\n');

  const plan = createCollectionPlan();
  
  // –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–ª–∞–Ω
  const planPath = path.join('v0-unified-project', 'collection-plan.json');
  fs.writeFileSync(planPath, JSON.stringify(plan, null, 2));
  console.log(`‚úÖ –°–æ–∑–¥–∞–Ω –ø–ª–∞–Ω —Å–±–æ—Ä–∞: collection-plan.json`);

  // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
  componentsInfo.components.forEach(component => {
    const { componentDir, structure } = createComponentStructure(component);
    
    // –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    if (!fs.existsSync(componentDir)) {
      fs.mkdirSync(componentDir, { recursive: true });
    }

    // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª—ã –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
    Object.entries(structure).forEach(([filename, content]) => {
      const filePath = path.join(componentDir, filename);
      fs.writeFileSync(filePath, content);
    });
    
    console.log(`‚úÖ –°–æ–∑–¥–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è: ${component.name}`);
  });

  // –°–æ–∑–¥–∞–µ–º –≥–ª–∞–≤–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
  const mainPagePath = path.join('v0-unified-project', 'app', 'page.tsx');
  fs.writeFileSync(mainPagePath, createMainPage());
  console.log(`‚úÖ –°–æ–∑–¥–∞–Ω–∞ –≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞: app/page.tsx`);

  // –°–æ–∑–¥–∞–µ–º layout
  const layoutPath = path.join('v0-unified-project', 'app', 'layout.tsx');
  const layoutContent = `import type { Metadata } from 'next'
import { Inter } from 'next/font/google'
import './globals.css'

const inter = Inter({ subsets: ['latin'] })

export const metadata: Metadata = {
  title: 'v0.app Components Catalog',
  description: '–ï–¥–∏–Ω—ã–π –∫–∞—Ç–∞–ª–æ–≥ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ v0.app',
}

export default function RootLayout({
  children,
}: {
  children: React.ReactNode
}) {
  return (
    <html lang="en">
      <body className={inter.className}>{children}</body>
    </html>
  )
}`;
  fs.writeFileSync(layoutPath, layoutContent);
  console.log(`‚úÖ –°–æ–∑–¥–∞–Ω layout: app/layout.tsx`);

  // –°–æ–∑–¥–∞–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏
  const globalsPath = path.join('v0-unified-project', 'app', 'globals.css');
  const globalsContent = `@tailwind base;
@tailwind components;
@tailwind utilities;

:root {
  --foreground-rgb: 0, 0, 0;
  --background-start-rgb: 214, 219, 220;
  --background-end-rgb: 255, 255, 255;
}

@media (prefers-color-scheme: dark) {
  :root {
    --foreground-rgb: 255, 255, 255;
    --background-start-rgb: 0, 0, 0;
    --background-end-rgb: 0, 0, 0;
  }
}

body {
  color: rgb(var(--foreground-rgb));
  background: linear-gradient(
      to bottom,
      transparent,
      rgb(var(--background-end-rgb))
    )
    rgb(var(--background-start-rgb));
}`;
  fs.writeFileSync(globalsPath, globalsContent);
  console.log(`‚úÖ –°–æ–∑–¥–∞–Ω—ã –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏: app/globals.css`);

  console.log(`\nüéâ –ü–ª–∞–Ω —Å–±–æ—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω!`);
  console.log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:`);
  console.log(`   - –í—Å–µ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤: ${plan.statistics.totalComponents}`);
  console.log(`   - –§–∞–∑ —Å–±–æ—Ä–∞: ${plan.phases.length}`);
  console.log(`   - –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–Ω–∞ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤`);

  console.log(`\nüìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:`);
  console.log(`   1. cd v0-unified-project`);
  console.log(`   2. npm install`);
  console.log(`   3. npm run dev`);
  console.log(`   4. –ù–∞—á–∞—Ç—å Phase 1: –ü–æ–∏—Å–∫ GitHub —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤ —á–µ—Ä–µ–∑ MCP Vercel`);
  console.log(`   5. –ù–∞—á–∞—Ç—å Phase 2: –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–æ–¥–∞ —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä`);
}

if (require.main === module) {
  main();
}

module.exports = { createCollectionPlan, createComponentStructure, createMainPage };
